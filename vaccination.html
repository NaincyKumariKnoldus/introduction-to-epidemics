

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Changing individual susceptibility &#8212; Epidemic modelling &amp;ndash; Some notes, maths, and code</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="Asymptomatic transmission" href="seir.html" />
    <link rel="prev" title="Herd immunity" href="herd.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Epidemic modelling &ndash; Some notes, maths, and code</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   Epidemic modelling – Some notes, maths, and code
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="model.html">
   Models and modelling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="progress.html">
   Disease progression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="continuous.html">
   Compartmented models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="network.html">
   Network models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="er.html">
   Making fewer connections
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tracing.html">
   Contact tracing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="thresholds.html">
   Epidemic threshold
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hcn.html">
   Human contact networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="herd.html">
   Herd immunity
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Changing individual susceptibility
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="seir.html">
   Asymptomatic transmission
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="distancing.html">
   Physical distancing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="conclusion.html">
   Conclusion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reading.html">
   To find out more
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zbibliography.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="genindex.html">
   Index
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="notes.html">
   Notes on production
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="acknowledgements.html">
   Acknowledgements
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="about.html">
   About the author
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="copyright.html">
   Copyright
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="print.html">
   Print copies
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/vaccination.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/simoninireland/introduction-to-epidemics"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/simoninireland/introduction-to-epidemics/master?urlpath=tree/vaccination.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/simoninireland/introduction-to-epidemics/blob/master/vaccination.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vaccines">
   Vaccines
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#epidemics-on-human-contact-networks">
   Epidemics on human contact networks
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vaccination-in-sir">
   Vaccination in SIR
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vaccinating-the-population-at-random">
   Vaccinating the population at random
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-super-are-super-spreaders">
   How super are super-spreaders?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#targetted-vaccination">
   Targetted vaccination
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vaccination-without-vaccines">
   “Vaccination” without vaccines
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions-for-discussion">
   Questions for discussion
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="changing-individual-susceptibility">
<h1>Changing individual susceptibility<a class="headerlink" href="#changing-individual-susceptibility" title="Permalink to this headline">¶</a></h1>
<p>We now turn to <span class="target" id="index-0"></span>countermeasures that we can take to reduce the size of an epidemic.</p>
<p>There are several ways we can approach this. In this chapter we’ll look at ways in which we can change an individual’s response to potential infection. By making individuals less likely to be infected, we reduce the chances that an encounter will result in secondary infection and therefor reduce the chance of the disease spreading widely. We’ll see that it matters <em>how many</em> individuals’ susceptibility we modify, and often <em>which individuals</em>.</p>
<p>(In a  later chapter we’ll look at an alternative approach which leaves individual susceptibilities alone but <a class="reference internal" href="distancing.html"><span class="doc">changes the topology of encounters</span></a> at the population level.)</p>
<p><strong>Vaccination</strong> changes susceptibility at a <strong>biological</strong> level, by changing an individual’s immune response, and in this chapter we’ll talk about the ways in which vaccines affect epidemic spreading in a population. But it’s important to remember that the same effect can be achieved at a <strong>physical</strong> level, with no vaccine and in fact no biological interventions at all, as we’ll <a class="reference internal" href="#sec-vaccination-no-vaccine"><span class="std std-ref">see later</span></a>. From the perspective of epidemic spreading both biological and physical approaches behave in largely the same way.</p>
<div class="section" id="vaccines">
<h2>Vaccines<a class="headerlink" href="#vaccines" title="Permalink to this headline">¶</a></h2>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Edgar Allan Poe’s short story <em>The Masque of the Red Death</em> fictionalises the ineffectiveness of this strategy, especially when faced with a supernatural opponent.</p>
</div>
<p>For most of history we have been unable to affect the progress of diseases by biological means. Instead, we’ve been limited to using topology – isolation and <span class="target" id="index-1"></span>quarantine – to reduce the spread of a disease, or slow down its progress. For many diseases these approaches were ineffective given the dynamics of the disease and the conditions of daily life for the majority of the population, and even being sufficiently rich to lock oneself away was not guaranteed to spare one from infection.</p>
<p>This changed at the turn of the nineteenth century with the introduction of <strong><span class="target" id="index-2"></span>vaccines</strong>. Vaccination was first tried at scale by Sir Edward Jenner, who realised the similarities between smallpox – a ravaging disease and a cause of immense suffering – and cowpox, a far milder complaint commonly encountered in milkmaids who picked it up from cattle. This proved to be the first in a long line of innovations that have now erradicated smallpox entirely.</p>
<p>Vaccines work by priming a person’s immune system so that, if they are later infected, they already have the immunological machinery needed to fight the pathogen off. Critically, this reduces the time between infection happening and the immune response starting, meaning that there is less pathogen to fight off and therefore a better chance of preventing the infection taking hold in that individual. Sometimes this can be so effective that the individual is unaware they were even infected; more commonly they suffer a milder version of the disease, with less severe symptoms from which they recover more quickly.</p>
<p>There are lots of ways to build a vaccine. One can do as Jenner did and use a <strong>mild variant</strong> of the disease one is interested in. One can take the actual disease and produce a <strong>denatured</strong> version that cannot cause infection but does nevertheless prime the immune system. Modern vaccines are often even more specific than this, identifying some of the surface proteins that characterise the pathogen and introducing only them as a primer.</p>
<p>Immunology is an immense subject, but fortunately we don’t need to understand its mechanics – how it works in <em>individuals</em> – to understand its epidemiology – how it works in <em>populations</em>. In fact, as we’ll see, we don’t need a vaccine in order to still get the <em>effects</em> of vaccination.</p>
</div>
<div class="section" id="epidemics-on-human-contact-networks">
<h2>Epidemics on human contact networks<a class="headerlink" href="#epidemics-on-human-contact-networks" title="Permalink to this headline">¶</a></h2>
<p>Let’s revisit <a class="reference internal" href="hcn.html"><span class="doc">human contact networks</span></a> as a substrate for an epidemic. Such a <span class="target" id="index-3"></span>contact network resembles a <span class="target" id="index-4"></span>powerlaw-with-cutoff topology rather than the “normal” topology of an <a class="reference internal" href="er.html"><span class="doc">ER network</span></a>: there are nodes that have degrees (contacts) substantially larger than the mean of the network overall. We made the point that such networks are <a class="reference internal" href="hcn.html#sec-hcn-always-percolate"><span class="std std-ref">very good at spreading diseases</span></a>.</p>
<p>How good? Human contact networks have different cutoffs, the point at which the probability of having nodes with higher degrees reduces dramatically. We can explore what this means by picking the dynamics of a disease and varying the cutoff to see how the <em>same</em> disease propagates on networks with <em>different</em> topologies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># network parameters</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># simulation time</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># disease dynamic parameters</span>
<span class="n">pInfected</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">pInfect</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">pRemove</span> <span class="o">=</span> <span class="mf">0.002</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up the experiment</span>
<span class="n">lab</span> <span class="o">=</span> <span class="n">epyc</span><span class="o">.</span><span class="n">Lab</span><span class="p">()</span>
<span class="n">lab</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_INFECTED</span><span class="p">]</span> <span class="o">=</span> <span class="n">pInfected</span>
<span class="n">lab</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_INFECT</span><span class="p">]</span> <span class="o">=</span> <span class="n">pInfect</span>
<span class="n">lab</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_REMOVE</span><span class="p">]</span> <span class="o">=</span> <span class="n">pRemove</span>
<span class="n">lab</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span>
<span class="n">lab</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">ALPHA</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>
<span class="n">lab</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">CUTOFF</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span>
                                                <span class="n">num</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">lab</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">DELTA</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="mi">50</span>

<span class="c1"># perform one monitoried epidemic</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MonitoredSIR</span><span class="p">()</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">PLCNetworkDynamics</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">lab</span><span class="o">.</span><span class="n">runExperiment</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plotting the results for the different cutoff values yields the following.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">dataframe</span><span class="p">()</span>
<span class="n">cutoffs</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">CUTOFF</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    
<span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span> <span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">cutoffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                      <span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cutoffs</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                      <span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">cutoffs</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> 
                      <span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cutoffs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="p">]:</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">CUTOFF</span><span class="p">]</span> <span class="o">==</span> <span class="n">cutoff</span><span class="p">]</span>
    <span class="n">timeseries</span> <span class="o">=</span> <span class="n">rc</span><span class="p">[</span><span class="n">MonitoredSIR</span><span class="o">.</span><span class="n">TIMESERIES</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">MonitoredSIR</span><span class="o">.</span><span class="n">OBSERVATIONS</span><span class="p">]</span>
    <span class="n">sss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">]</span>
    <span class="n">iss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">INFECTED</span><span class="p">]</span>
    <span class="n">rss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sss</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;suceptible&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">iss</span><span class="p">,</span> <span class="s1">&#39;g.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;infected&#39;</span><span class="p">)</span>
    <span class="c1">#ax.plot(ts, rss, &#39;ks&#39;, label=&#39;removed&#39;)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">kappa = </span><span class="si">{kappa:.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kappa</span><span class="o">=</span><span class="n">cutoff</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

<span class="c1"># fine-tune the diagram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;SIR over powerlaw networks for different cutoffs ($N = </span><span class="si">{n}</span><span class="s1">, </span><span class="se">\\</span><span class="s1">alpha=</span><span class="si">{a}</span><span class="s1">$)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">alpha</span><span class="p">))</span>
<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;population that is...&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/vaccination_12_0.png" src="_images/vaccination_12_0.png" />
</div>
</div>
<p>This is telling us that networks with a small maximum number of contacts (<span class="math notranslate nohighlight">\(\kappa = 10\)</span>) have relative small epidemics that appear quite slowly: the “peak” of the infections occurs farther into the outbreak. As we increase <span class="math notranslate nohighlight">\(\kappa\)</span> we see larger epidemics happening faster (closer to the start of the outbreak), until the results seem to stabilise and not change much as we continue to increase <span class="math notranslate nohighlight">\(\kappa\)</span>: a maximum of about 30 contacts seems to be enough to infect about half the popuation at the peak.</p>
</div>
<div class="section" id="vaccination-in-sir">
<span id="sec-vaccination-sir"></span><h2>Vaccination in SIR<a class="headerlink" href="#vaccination-in-sir" title="Permalink to this headline">¶</a></h2>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>We’ve obviously simplified this, as anyone who’s caught a disease for which they’ve been vaccinated will know. Vaccination doesn’t always give <span class="target" id="index-5"></span>full immunity against infection.</p>
</div>
<p>What does vaccination look like in the <a class="reference internal" href="continuous.html"><span class="doc">SIR model</span></a>? A vaccinated individual is one who cannot catch the disease. In <span class="target" id="index-6"></span>model terms it means that an individual who exhibits that characteristics of having already had the disease, and having been “removed” into the <strong>R</strong> compartment. In fact this is what’s happening biologically as well: a vaccinated individual has been exposed to a substance that renders them the same <em>as if</em> they’d had the disease, without actually requiring them to <em>have had</em> it. The effect we’re looking for is <a class="reference internal" href="herd.html"><span class="doc">herd immunity</span></a>, where there are <span class="target" id="index-7"></span>insufficient susceptible individuals in a population to let the disease establish itelf. But critically we’re looking for herd immunity <em>without having the disease pass through the population first</em>, with all the suffering and (possibly) death that this might entail.</p>
<p>We could model vaccination using a new compartment, leading to a model that might be called <strong>SIVR</strong> capturing the vaccinated individuals <strong>V</strong>. But in conditions of total vaccinated immunity the <strong>V</strong> individuals will behave identically to the <strong>R</strong> individuals, so we may as well simply treat them identically too. (If we were wanting to explore <span class="target" id="index-8"></span>partial immunity through vaccination then SIVR would let us have, for example, different values of <span class="math notranslate nohighlight">\(p_{\mathit{infect}}\)</span> depending on whether it’s an <strong>S</strong> or a <strong>V</strong> individual being potentially infected: <strong>V</strong> becomes a halfway-house between <strong>S</strong> (fully susceptible) and <strong>R</strong> (fully removed).</p>
</div>
<div class="section" id="vaccinating-the-population-at-random">
<span id="sec-vaccination-random"></span><h2>Vaccinating the population at random<a class="headerlink" href="#vaccinating-the-population-at-random" title="Permalink to this headline">¶</a></h2>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>For many years seasonal <span class="target" id="index-9"></span>influenza vaccines were grown in chicken eggs, meaning that they were unsuitable for vegans and anyone with a dairy allergy. Modern flu vaccines aren’t created this way.</p>
</div>
<p>Most vaccines are applied broadly to a population, typically in childhood for a range of common diseases which most people will face. Ideally everyone is vaccinated; in practice some are missed for various reasons, in some the vaccine will not “take”, some must avoid it for unrelated medical reasons, and so forth.</p>
<p>We could try to model the ways in which this process happens in detail, but the overall effect is very similar to the case where we take a population and randomly vaccinate some percentage of the individuals before starting the infection. Since this is SIR, this means that we randomly assign some fraction <span class="math notranslate nohighlight">\(p_{vaccinated}\)</span> of nodes to the <strong>R</strong> compartment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MonitoredVaccinatedSIR</span><span class="p">(</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="p">,</span> <span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="p">):</span>
    
    <span class="n">P_VACCINATED</span> <span class="o">=</span> <span class="s1">&#39;pVaccinated&#39;</span>   <span class="c1">#: Probability that an</span>
                                   <span class="c1"># individual is initially removed.</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MonitoredVaccinatedSIR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Build the observation process.</span>
<span class="sd">        </span>
<span class="sd">        :param params: the experimental parameters&#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MonitoredVaccinatedSIR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># change the initial compartment probabilities to vaccinate (remove) some fraction</span>
        <span class="n">pInfected</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_INFECTED</span><span class="p">]</span>
        <span class="n">pVaccinated</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">P_VACCINATED</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeCompartmentInitialOccupancy</span><span class="p">(</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">INFECTED</span><span class="p">,</span> <span class="n">pInfected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeCompartmentInitialOccupancy</span><span class="p">(</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">,</span> <span class="n">pVaccinated</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeCompartmentInitialOccupancy</span><span class="p">(</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">pInfected</span> <span class="o">-</span> <span class="n">pVaccinated</span><span class="p">)</span>

        <span class="c1"># also monitor other compartments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackNodesInCompartment</span><span class="p">(</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackNodesInCompartment</span><span class="p">(</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can choose any number we like for <span class="math notranslate nohighlight">\(p_{vaccinated}\)</span>, with 60% being a typical target for immunisation campaigns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pVaccinated</span> <span class="o">=</span> <span class="mf">0.6</span>
</pre></div>
</div>
</div>
</div>
<p>Leaving all other experimental parameters the same from above, let’s choose a value of <span class="math notranslate nohighlight">\(\kappa=57\)</span> as a cutoff that we saw created an epidemic in a unvaccinated population, and run an experiment where we first vaccinate (remove) a fraction of nodes at random.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lab</span><span class="p">[</span><span class="n">MonitoredVaccinatedSIR</span><span class="o">.</span><span class="n">P_VACCINATED</span><span class="p">]</span> <span class="o">=</span> <span class="n">pVaccinated</span>
<span class="n">lab</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">CUTOFF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">57</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">MonitoredVaccinatedSIR</span><span class="p">()</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">PLCNetworkDynamics</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">lab</span><span class="o">.</span><span class="n">runExperiment</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">dataframe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can then see the progress of the <em>same</em> epidemic on the <em>same</em> network topology, but in the presence of an effective vaccine applied to a fraction of the population.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="n">rc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">MonitoredVaccinatedSIR</span><span class="o">.</span><span class="n">P_VACCINATED</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.6</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">TIMESERIES</span><span class="p">]</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">MonitoredVaccinatedSIR</span><span class="o">.</span><span class="n">OBSERVATIONS</span><span class="p">]</span>
<span class="n">sss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">]</span>
<span class="n">iss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">INFECTED</span><span class="p">]</span>
<span class="n">rss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sss</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;suceptible&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">iss</span><span class="p">,</span> <span class="s1">&#39;g.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;infected&#39;</span><span class="p">)</span>
<span class="c1">#ax.plot(ts, rss, &#39;ks&#39;, label=&#39;removed&#39;)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span>    
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">pVaccinated</span> <span class="o">-</span> <span class="n">pInfected</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;population that is...&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SIR epidemic in the presence of </span><span class="si">{v:.0f}</span><span class="s1">% vaccination ($</span><span class="se">\\</span><span class="s1">kappa = </span><span class="si">{k}</span><span class="s1">$)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="n">MonitoredVaccinatedSIR</span><span class="o">.</span><span class="n">P_VACCINATED</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">CUTOFF</span><span class="p">]),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/vaccination_24_0.png" src="_images/vaccination_24_0.png" />
</div>
</div>
<p>Comparing this to the figure above shows quite a dramatic reduction in the outbreak size.</p>
<p>But wait! – there might be a problem Look at the y-axis in this graph. Notice that the maximum susceptible population is about 4000, even though the network has 10000 nodes. A moment’s thought shows why: we modelled vaccination as being  pre-emptively removed, leaving fewer susceptibles. Could it be that this result is what we’d <em>expect</em> on a smaller network? In other words, is there a <span class="target" id="index-10"></span>size effect coming into play as we move from 10000 down to 4000 individuals?</p>
<p>We should be careful and <span class="target" id="index-11"></span>check this possibility. We can do so by working out the size of the unvaccinated population and creating a network with the same topology of this size, and then running our epidemic over it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nsmall</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">pVaccinated</span> <span class="o">-</span> <span class="n">pInfected</span><span class="p">))</span>
<span class="n">lab</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">Nsmall</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">MonitoredSIR</span><span class="p">()</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">PLCNetworkDynamics</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">lab</span><span class="o">.</span><span class="n">runExperiment</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">dataframe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="c1"># plot epidemic on unvaccinated network</span>
<span class="n">rc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">N</span><span class="p">]</span> <span class="o">==</span> <span class="n">Nsmall</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">TIMESERIES</span><span class="p">]</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">MonitoredVaccinatedSIR</span><span class="o">.</span><span class="n">OBSERVATIONS</span><span class="p">]</span>
<span class="n">sss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">]</span>
<span class="n">iss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">INFECTED</span><span class="p">]</span>
<span class="n">rss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sss</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;suceptible (no vaccination)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">iss</span><span class="p">,</span> <span class="s1">&#39;g.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;infected (no vaccination)&#39;</span><span class="p">)</span>
<span class="c1">#ax.plot(ts, rss, &#39;ks&#39;, label=&#39;removed&#39;)</span>

<span class="c1"># plot results on same-sized network reduced in</span>
<span class="c1"># size by vaccination</span>
<span class="n">rc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">MonitoredVaccinatedSIR</span><span class="o">.</span><span class="n">P_VACCINATED</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.6</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">TIMESERIES</span><span class="p">]</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">MonitoredVaccinatedSIR</span><span class="o">.</span><span class="n">OBSERVATIONS</span><span class="p">]</span>
<span class="n">sss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">]</span>
<span class="n">iss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">INFECTED</span><span class="p">]</span>
<span class="n">rss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sss</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;suceptible (post vaccination)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">iss</span><span class="p">,</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;infected (post vaccination)&#39;</span><span class="p">)</span>
<span class="c1">#ax.plot(ts, rss, &#39;ks&#39;, label=&#39;removed&#39;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span>    
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nsmall</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;population that is...&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SIR epidemic with and without vaccination ($N = </span><span class="si">{n}</span><span class="s1">, </span><span class="se">\\</span><span class="s1">kappa = </span><span class="si">{k}</span><span class="s1">$)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">Nsmall</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">CUTOFF</span><span class="p">]),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/vaccination_27_0.png" src="_images/vaccination_27_0.png" />
</div>
</div>
<p>The first thing to see is that the two graphs are different: it’s not <em>just</em> the size of the network that affects things. In the small-but-unvaccinated network we see a larger epidemic; in the vaccinated network we see a much smaller and slower outbreak. What is different between the two cases, since the networks are the same size?</p>
<p>A moment’s thought may suggest the answer. We’ve created two networks with the same topology, one where a fraction of nodes are removed by vaccination, and one where a number of nodes really had been removed (or rather, were never present in the network in the first place). Both networks have high-degree nodes, as we’d expect for powerlaw-with-cutoff networks. But in the latter (vaccinated) case, some of those high-degree nodes will have been vaccinated and so are not able to spread the disease. And since the disease spreads through contact between <strong>S</strong> and <strong>I</strong> nodes, we lose the opportunity to infect a high-degree node that could act as <span class="target" id="index-12"></span>super-spreaders able to infect a large number of nodes. And that reduction in super-spreading is enough to change the dynamics of the disease.</p>
</div>
<div class="section" id="how-super-are-super-spreaders">
<span id="sec-vaccination-superspreaders"></span><h2>How super are super-spreaders?<a class="headerlink" href="#how-super-are-super-spreaders" title="Permalink to this headline">¶</a></h2>
<p>Let’s look at some numbers. Firstly, how many contacts does the most highly-connected node have?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">network</span><span class="p">()</span>
<span class="n">ks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">g</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Maximum degree = </span><span class="si">{kmax}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">ks</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Maximum degree = 62
</pre></div>
</div>
</div>
</div>
<p>That’s a high number. What about the number of contacts for an averagely-connected node?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean node degree = </span><span class="si">{kmean:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kmean</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ks</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean node degree = 2.59
</pre></div>
</div>
</div>
</div>
<p><em>Very</em> different, and it’s this feature that differentiates a human contact network from an ER network: the existence of nodes with degrees that are much higher than the average. In fact such networks have a <strong><span class="target" id="index-13"></span>long tail</strong> of nodes with <span class="target" id="index-14"></span>high degrees: only a small number relative to the size of the network overall, but nonetheless able to pass infection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Highest </span><span class="si">{h}</span><span class="s1"> nodes by degree </span><span class="si">{l}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">ks</span><span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">:]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Highest 10 nodes by degree [43, 44, 45, 46, 46, 50, 54, 54, 56, 62]
</pre></div>
</div>
</div>
</div>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>There are other ways we could do this too, for example by making the probability of vaccinating a node inversely proportional to its degree.</p>
</div>
<p>How important are these individuals in the spread of the disease? We can study that by excluding them from our model vaccination programme. Instead of vaccinating some fraction of the network, after vaccination we will make sure that some fraction of the highest-degree nodes are susceptible. Essentially we swap high-degree nodes for lower-degree nodes in our vaccination programme.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MonitoredVaccinatedLowDegreeSIR</span><span class="p">(</span><span class="n">MonitoredVaccinatedSIR</span><span class="p">):</span>

    <span class="n">K_HIGH_FRACTION</span> <span class="o">=</span> <span class="s1">&#39;k_high_fraction&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MonitoredVaccinatedLowDegreeSIR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MonitoredVaccinatedLowDegreeSIR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        
        <span class="c1"># look through the fraction of high-degree nodes and</span>
        <span class="c1"># make them susceptible again, replacing them with</span>
        <span class="c1"># another node chosen at random</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">()</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">K_HIGH_FRACTION</span><span class="p">])</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
        <span class="n">ks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">degrees</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">ks_high</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ks</span><span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">:])</span>
        <span class="n">ns_high</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ns</span> <span class="k">if</span> <span class="n">degrees</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ks_high</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ns_high</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCompartment</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">:</span>
                <span class="c1"># node is removed, make it susceptible again</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setCompartment</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">)</span>
                
                <span class="c1"># choose another node and remove it in</span>
                <span class="c1"># place of the node we just forced to</span>
                <span class="c1"># be susceptible</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">ns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCompartment</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">:</span>
                        <span class="c1"># found a susceptible node, remove it</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setCompartment</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">)</span>
                        <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
<p>Running the experiment, again with the same disease parameters and network topology as before, shows us the effects of this failure in vaccination.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kHighFraction</span> <span class="o">=</span> <span class="mf">0.08</span>  <span class="c1"># highest-degree 8% </span>

<span class="n">lab</span><span class="p">[</span><span class="n">MonitoredVaccinatedLowDegreeSIR</span><span class="o">.</span><span class="n">K_HIGH_FRACTION</span><span class="p">]</span> <span class="o">=</span> <span class="n">kHighFraction</span>
<span class="n">lab</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">MonitoredVaccinatedLowDegreeSIR</span><span class="p">()</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">PLCNetworkDynamics</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">lab</span><span class="o">.</span><span class="n">runExperiment</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">dataframe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="n">rc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">MonitoredVaccinatedLowDegreeSIR</span><span class="o">.</span><span class="n">K_HIGH_FRACTION</span><span class="p">]</span> <span class="o">==</span> <span class="n">kHighFraction</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">TIMESERIES</span><span class="p">]</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">MonitoredVaccinatedSIR</span><span class="o">.</span><span class="n">OBSERVATIONS</span><span class="p">]</span>
<span class="n">sss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">]</span>
<span class="n">iss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">INFECTED</span><span class="p">]</span>
<span class="n">rss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sss</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;suceptible&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">iss</span><span class="p">,</span> <span class="s1">&#39;g.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;infected&#39;</span><span class="p">)</span>
<span class="c1">#ax.plot(ts, rss, &#39;ks&#39;, label=&#39;removed&#39;)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span>    
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">pInfected</span> <span class="o">-</span> <span class="n">pVaccinated</span><span class="p">)</span> <span class="o">+</span> <span class="n">N</span> <span class="o">*</span> <span class="n">kHighFraction</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;population that is...&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SIR epidemic without vaccination of </span><span class="si">{khigh:.0f}% hi</span><span class="s1">ghest-degree nodes ($N = </span><span class="si">{n}</span><span class="s1">, </span><span class="se">\\</span><span class="s1">kappa = </span><span class="si">{k:.0f}</span><span class="s1">$)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">khigh</span><span class="o">=</span><span class="n">kHighFraction</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">CUTOFF</span><span class="p">]),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/vaccination_40_0.png" src="_images/vaccination_40_0.png" />
</div>
</div>
<p>Letting a small fraction of the high-degree nodes – <em>i.e.</em>, the most connected individuals – remain susceptible changes the epidemic again, making it larger and faster. It’s not only the <em>size</em> of the vaccinated population that counts: it’s <em>who we vaccinate</em> (or, in this case, don’t vaccinate) that really matters. Missing even a small fraction of the highly connected will radically reduce the effectiveness of a vaccination programme.</p>
</div>
<div class="section" id="targetted-vaccination">
<span id="sec-vaccination-countermeasure"></span><h2>Targetted vaccination<a class="headerlink" href="#targetted-vaccination" title="Permalink to this headline">¶</a></h2>
<p>So the existence of high-degree nodes offers an opportunity for the disease to infect far more individuals if those nodes are not protected by vaccination.</p>
<p>But this also offers opportunities for further countermeasures. If high-degree nodes are important in spreading the disease, what if – instead of vaccinating at random – we instead <em>explicitly target</em> those nodes that we believe are the most important in spreading the disease? That might make our programme more effective. It might also mean that we could perform a smaller, more focused, programme, where instead of vaccinating widely at random we <span class="target" id="index-15"></span>vaccinate narrowly but in a focused, “smart” way.</p>
<p>We can explore this too. Rather than perform random vaccination, we instead target a specific fraction of the highest-degree nodes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MonitoredVaccinatedHighDegreeSIR</span><span class="p">(</span><span class="n">MonitoredSIR</span><span class="p">):</span>

    <span class="n">K_VACCINATED_FRACTION</span> <span class="o">=</span> <span class="s1">&#39;k_vaccinated_fraction&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MonitoredVaccinatedHighDegreeSIR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MonitoredVaccinatedHighDegreeSIR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># look for the fraction of highest-degree nodes</span>
        <span class="c1"># and vaccinate (remove) them</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">()</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">K_VACCINATED_FRACTION</span><span class="p">])</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
        <span class="n">ks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">degrees</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">ks_high</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ks</span><span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">:])</span>
        <span class="n">ns_high</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ns</span> <span class="k">if</span> <span class="n">degrees</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ks_high</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ns_high</span><span class="p">:</span>
            <span class="c1"># remove (vaccinate) the node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCompartment</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>How large a fraction do we need to target? Let’s be ambitious and start small, vaccinating only 2% of nodes – thirty times fewer than before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kVaccinatedFraction</span> <span class="o">=</span> <span class="mf">0.02</span>    <span class="c1"># top 2% highest-degree nodes</span>
<span class="n">lab</span><span class="p">[</span><span class="n">MonitoredVaccinatedHighDegreeSIR</span><span class="o">.</span><span class="n">K_VACCINATED_FRACTION</span><span class="p">]</span> <span class="o">=</span> <span class="n">kVaccinatedFraction</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">MonitoredVaccinatedHighDegreeSIR</span><span class="p">()</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">PLCNetworkDynamics</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">lab</span><span class="o">.</span><span class="n">runExperiment</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">dataframe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="n">rc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">MonitoredVaccinatedHighDegreeSIR</span><span class="o">.</span><span class="n">K_VACCINATED_FRACTION</span><span class="p">]</span> <span class="o">==</span> <span class="n">kVaccinatedFraction</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">TIMESERIES</span><span class="p">]</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">MonitoredVaccinatedSIR</span><span class="o">.</span><span class="n">OBSERVATIONS</span><span class="p">]</span>
<span class="n">sss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">]</span>
<span class="n">iss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">INFECTED</span><span class="p">]</span>
<span class="n">rss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sss</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;suceptible&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">iss</span><span class="p">,</span> <span class="s1">&#39;g.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;infected&#39;</span><span class="p">)</span>
<span class="c1">#ax.plot(ts, rss, &#39;ks&#39;, label=&#39;removed&#39;)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span>    
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;population that is...&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SIR epidemic vaccinating only the </span><span class="si">{kvac:.0f}% hi</span><span class="s1">ghest-degree nodes ($N = </span><span class="si">{n}</span><span class="s1">, </span><span class="se">\\</span><span class="s1">kappa = </span><span class="si">{k:.0f}</span><span class="s1">$)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kvac</span><span class="o">=</span><span class="n">kVaccinatedFraction</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="n">PLCNetworkDynamics</span><span class="o">.</span><span class="n">CUTOFF</span><span class="p">]),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/vaccination_47_0.png" src="_images/vaccination_47_0.png" />
</div>
</div>
<p>That’s quite amazing! With almost no-one vaccinated – 200 in a network of 10000 – we both reduce and slow the epidemic. Both these effects are important. The total number of people infected is smaller, but so too is the “ramp-up” at the start of the epidemic, which means less stress is placed on health systems dealing with the influx of sick peoiple.</p>
<p>When people talk of <strong><span class="target" id="index-16"></span>flattening the curve</strong>, this is the effect they’re aiming at – achieved in this case through targeted vaccination of a tiny fraction of the population.</p>
<p>This reduction in vaccination effort makes it faster, cheaper, and more reliable – <em>if</em> we can identify and target the super-spreaders. But this might be possible, because we know that the super-spreaders are the highest-degree nodes, who are simply the ones with the most exposure to other people. In the modern world a person’s contact degree is often at least partially a function of their job, and so by targeting those whose jobs bring them into contact with the most people – and especially into contact with the most <em>infected</em> people – we can create a very effective vaccination strategy and roll it out quickly.</p>
</div>
<div class="section" id="vaccination-without-vaccines">
<span id="sec-vaccination-no-vaccine"></span><h2>“Vaccination” without vaccines<a class="headerlink" href="#vaccination-without-vaccines" title="Permalink to this headline">¶</a></h2>
<p>We said at the beginning of this chapter that immunology was an enormously complicated topic but one whose details didn’t matter for population-level modelling. The experiments we conducted above have hopefully convinced you of this.</p>
<p>But if this is the case, then it’s not vaccination that’s the important feature for our purposes. Any technology <em>that behaves like a vaccine</em> preventing the infection of those we treat, will have the same effect.</p>
<p>What technologies might these be? An obvious example is personal protective equipment such as face masks, surgical gloves, and the like, issued to those whom we identify as being in high-contact professions such as care workers, medical workers, bus drivers, and the like – anyone who, if they were to become infected, would have the opportunity to spread the disease to a disproportionate number of others. Most importantly this doesn’t require that we protect <em>everyone</em>, just that we protect <em>the most important</em> people in the contact network, whom we identify by their contact degree.</p>
</div>
<div class="section" id="questions-for-discussion">
<h2>Questions for discussion<a class="headerlink" href="#questions-for-discussion" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>What groups in society would you choose for targetted vaccination?</p></li>
<li><p>Would you be happy <em>just</em> doing targetted vaccination, or would you want “general” vaccination too?</p></li>
<li><p>If we never have a vaccine for a disease, how can we protect ourselves against it?</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="herd.html" title="previous page">Herd immunity</a>
    <a class='right-next' id="next-link" href="seir.html" title="next page">Asymptomatic transmission</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Simon Dobson<br/>
        
            &copy; <a href="copyright.html">Copyright</a> 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-42241903-2', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>