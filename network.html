

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Connectivity &#8212; Epidemic modelling &amp;ndash; an introduction</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/mystnb.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .secondtoggle, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Notes" href="notes.html" />
    <link rel="prev" title="The simplest model" href="continuous.html" />


    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<!-- Put requirejs at the end so it's always after bootstrap -->
<!-- TODO: remove this once https://github.com/pandas-dev/pydata-sphinx-theme/pull/149 is merged -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          

<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Epidemic modelling &ndash; an introduction</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="index.html">Epidemic modelling – An introduction</a>
  </li>
  <li class="">
    <a href="model.html">Models of disease</a>
  </li>
  <li class="">
    <a href="progress.html">The progession of a disease</a>
  </li>
  <li class="">
    <a href="continuous.html">The simplest model</a>
  </li>
  <li class="active">
    <a href="">Connectivity</a>
  </li>
  <li class="">
    <a href="notes.html">Notes</a>
  </li>
  <li class="">
    <a href="zbibliography.html">Annotated bibliography</a>
  </li>
  <li class="">
    <a href="about.html">About the author</a>
  </li>
</ul>
</nav>
<p class="navbar_footer">Powered by <a href="https://jupyterbook.org">Jupyter Book</a></p>
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="_sources/network.ipynb.txt"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.ipynb</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Edit this page -->
        

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
            <div class="dropdown-buttons">
                
                <a class="binder-button" href="https://mybinder.org/v2/gh/simoninireland/introduction-to-epidemics/master?urlpath=tree/network.ipynb"><button type="button" class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip" data-placement="left"><img class="binder-button-logo" src="_static/images/logo_binder.svg" alt="Interact on binder">Binder</button></a>
                
                
                
            </div>
        </div>
        

        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#networks" class="nav-link">Networks</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#complete-networks" class="nav-link">Complete networks</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#towards-sparser-social-networks" class="nav-link">Towards sparser social networks</a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 col-xxl-7 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="connectivity">
<h1>Connectivity<a class="headerlink" href="#connectivity" title="Permalink to this headline">¶</a></h1>
<p>One thing that may be bothering you about SIR is the idea of a population where all the possible interactions between individuals take place. You don’t meet everyonme in your city, town, or village like that on a regular basis: that isn’t how societies work.</p>
<p>Admittedly you get this sort of “complete mixing” in <em>some</em> scenarios. A school for young children (or, even better, a toddler’s nursery) perhaps works like this as the children go out to play together and everyone mixes with everyone else. And this is why diseases spread so rapidly through nurseries: one sick child will infect all the others.</p>
<p>This phenomenon can be used constructively, and when I was a child it was commonplace for parents to hold “chickpox parties” and bring all the neighbouring children together to play so they could be exposed – and then subsequently be immune from further infection, since chickenpox is quite well-modelled by SIR <a class="reference internal" href="notes.html#note-chickenpox"><span class="std std-ref">[1]</span></a>.</p>
<p>But in other cases the assumption of complete mixing is going to break down. And since we know that even a small change in infectivity can have a dramatic effect on the progress of an epidemic, can we change SIR to accommodate the social realities in which there are substantially fewer connections between individuals that we might expect?</p>
<p>There are a couple of ways we could answer this question.</p>
<p>Let’s return to the equation where all the intreresting stuff happens:</p>
<div class="math notranslate nohighlight">
\[
    \Delta I = p_{\mathit{infect}} \, SI - p_{remove} I
\]</div>
<p>The first term essentially takes all the possible contacts (all <span class="math notranslate nohighlight">\(S \times I\)</span> of them) and “exposes” them to the <span class="math notranslate nohighlight">\(p_{\mathit{infect}}\)</span> factor that decides what proportion of them are infected. If we want fewer contacts to be exposed, we can simply add another factor – let’s call it <span class="math notranslate nohighlight">\(f\)</span> for “fraction exposed” – that determines what proportion of the contacts are taken into consideration. This would lead os to re-write the above equation as:</p>
<div class="math notranslate nohighlight">
\[
    \Delta I = p_{\mathit{infect}} \, (f \, SI) - p_{remove} I
\]</div>
<p>If <span class="math notranslate nohighlight">\(f = 0\)</span> then there are no potentially infectious contacts; if <span class="math notranslate nohighlight">\(f = 1\)</span> then <em>all</em> contacts are potentially infectious and we recover our original equation; and for values of <span class="math notranslate nohighlight">\(f\)</span> such that <span class="math notranslate nohighlight">\(0 \lt f \lt 1\)</span> we choose the fraction of contacts we want to happen.</p>
<div class="section" id="networks">
<h2>Networks<a class="headerlink" href="#networks" title="Permalink to this headline">¶</a></h2>
<p>There is another, more interesting, approach that uses networks, and it’s this approach that we’ll now turn to.</p>
<p>A <em>network</em> is simply a collection of <em>nodes</em> connected by <em>edges</em>. A road map is a good example of a network: the nodes are the road junctions, while the edges (which connect the junctions together) are the segments of roads. This is the reason we sometimes refer to the <em>road network</em>: it’s a collection of (bits of) road that meet at various points.</p>
<p>Another good example of a network – and closer to our current application – is a <em>social network</em>. In a social network the nodes are people and the edges are “social links” or “social contacts” between them. While we usually think of social networks as being online, like Facebook or Twitter, they idea works in the real world too: when you meet your family, go shopping, go to work, or indulge in any of the activities of daily life you add edges to your social network between yourself and the people you meet. Typically the number of people you’ll have social contact with will be considerably less that the entire population.</p>
<p>Do the same thing for everyone in the population, and you have a social network for that population. The nodes are the individuals; the edges are the potentially infection-carrying social contacts.</p>
</div>
<div class="section" id="complete-networks">
<h2>Complete networks<a class="headerlink" href="#complete-networks" title="Permalink to this headline">¶</a></h2>
<p>Suppose that, on your travels, you <em>did</em> actually happen to come into contact with everyone in the population, so that your social network had edges connecting you to everyone else. And suppose that everyone else did the same, so that everyone was connected to everyone. This is still a social network – a very dense one to be sure, but perhaps like that of a crowd at a rugby match. It also matches the assumptions we made earlier about complete mixing. So if we  ran a simulation of diosease spreading over this network, we’d presumably expect to see the same results as we did before.</p>
<p>Wouldn’t we?</p>
<p>Let’s try it. First we need the same equtions as we had before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_sir</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="c1"># turn the equations into update functions</span>
    <span class="k">def</span> <span class="nf">dS</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">beta</span> <span class="o">*</span> <span class="n">S</span> <span class="o">*</span> <span class="n">I</span>
    <span class="k">def</span> <span class="nf">dI</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">S</span> <span class="o">*</span> <span class="n">I</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">I</span>
    <span class="k">def</span> <span class="nf">dR</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">I</span>
    
    <span class="c1"># return the three functions</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">dS</span><span class="p">,</span> <span class="n">dI</span><span class="p">,</span> <span class="n">dR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">epidemic_sir</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">pInfected</span><span class="p">,</span> <span class="n">pInfect</span><span class="p">,</span> <span class="n">pRemove</span><span class="p">):</span>
    <span class="c1"># create the equations for these parameters</span>
    <span class="p">(</span><span class="n">dS</span><span class="p">,</span> <span class="n">dI</span><span class="p">,</span> <span class="n">dR</span><span class="p">)</span> <span class="o">=</span> <span class="n">make_sir</span><span class="p">(</span><span class="n">pInfect</span><span class="p">,</span> <span class="n">pRemove</span><span class="p">)</span>
    
    <span class="c1"># initial conditions</span>
    <span class="n">sss</span> <span class="o">=</span> <span class="p">[</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">pInfected</span><span class="p">)</span> <span class="p">]</span>   <span class="c1"># everyone is initially susceptible...</span>
    <span class="n">iss</span> <span class="o">=</span> <span class="p">[</span> <span class="n">N</span> <span class="o">*</span> <span class="n">pInfected</span> <span class="p">]</span>           <span class="c1"># ...except for this fraction...</span>
    <span class="n">rss</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span> <span class="p">]</span>                       <span class="c1"># ...and no-one starts off removed</span>

    <span class="c1"># push the initial conditions through the differential equations</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">dS</span><span class="p">(</span><span class="n">sss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">iss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">di</span> <span class="o">=</span> <span class="n">dI</span><span class="p">(</span><span class="n">sss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">iss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">dR</span><span class="p">(</span><span class="n">sss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">iss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">sss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ds</span><span class="p">)</span>
        <span class="n">iss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">di</span><span class="p">)</span>
        <span class="n">rss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span>
        
    <span class="c1"># return the time series</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">)),</span> <span class="n">sss</span><span class="p">,</span> <span class="n">iss</span><span class="p">,</span> <span class="n">rss</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And the same parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">pInfected</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">pRemove</span> <span class="o">=</span> <span class="mf">0.001</span>
</pre></div>
</div>
</div>
</div>
<p>We then need to simulate the epidemic spreading over the network. Fortunately Python has two libraries available to help us with this problem. The <code class="docutils literal notranslate"><span class="pre">networkx</span></code> library lets us represent networks in Python programs, which the <code class="docutils literal notranslate"><span class="pre">epydemic</span></code> library provides the tools for simulating epidemic (and other) processes running over those network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span>
<span class="kn">import</span> <span class="nn">epydemic</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">epydemic</span></code> has an SIR process built-in. Since we’re interested in then progress of the epidemic we’ll add some monitoring to get the same time series that we got for the continuous case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MonitoredSIR</span><span class="p">(</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="p">,</span> <span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A monitored epidemic.&#39;&#39;&#39;</span><span class="s1">&#39;&#39;</span>
 
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MonitoredSIR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Build the observation process.</span>
<span class="sd">        </span>
<span class="sd">        :param params: the experimental parameters&#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MonitoredSIR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># also monitor other compartments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackNodesInCompartment</span><span class="p">(</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackNodesInCompartment</span><span class="p">(</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now write a function to perform the simulation for given parameters of <code class="docutils literal notranslate"><span class="pre">pInfected</span></code>, <code class="docutils literal notranslate"><span class="pre">pInfect</span></code>, and <code class="docutils literal notranslate"><span class="pre">pRemove</span></code>. For completeness we’ll also pass the function a network over which to run the simulation. The function sets up the simulation using <code class="docutils literal notranslate"><span class="pre">epydemic</span></code>, runs it, and extracts the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">network_sir</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">pInfected</span><span class="p">,</span> <span class="n">pInfect</span><span class="p">,</span> <span class="n">pRemove</span><span class="p">):</span>
    <span class="c1"># create the simulator</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">MonitoredSIR</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">setMaximumTime</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">epydemic</span><span class="o">.</span><span class="n">StochasticDynamics</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

    <span class="c1"># set the simulation parameters</span>
    <span class="n">param</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">param</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_INFECTED</span><span class="p">]</span> <span class="o">=</span> <span class="n">pInfected</span>
    <span class="n">param</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_INFECT</span><span class="p">]</span> <span class="o">=</span> <span class="n">pInfect</span>
    <span class="n">param</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_REMOVE</span><span class="p">]</span> <span class="o">=</span> <span class="n">pRemove</span>
    <span class="n">param</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">DELTA</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="mi">50</span>          <span class="c1"># take 50 samples</span>
    
    <span class="c1"># run the simulation</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    
    <span class="c1"># extract the time series</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">experimentalResults</span><span class="p">()[</span><span class="n">MonitoredSIR</span><span class="o">.</span><span class="n">TIMESERIES</span><span class="p">]</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">MonitoredSIR</span><span class="o">.</span><span class="n">OBSERVATIONS</span><span class="p">]</span>
    <span class="n">sss</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">]</span>
    <span class="n">iss</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">INFECTED</span><span class="p">]</span>
    <span class="n">rss</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">]</span>

    <span class="c1"># return the time series</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sss</span><span class="p">,</span> <span class="n">iss</span><span class="p">,</span> <span class="n">rss</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To test our hypothesis, we need a complete “social network” to operate over. Such networks are often called <em>complete graphs</em>, and <code class="docutils literal notranslate"><span class="pre">networkx</span></code> can build one for us at whatever size we need, with every node connected by an edge to every other.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">complete_graph</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally we can run the equations <em>and</em> the network simulation and plot them together. If they generate the same results, we’d expect the two sets of lines to agree with each other.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">figure_format</span> <span class="o">=</span> <span class="s1">&#39;svg&#39;</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="n">pInfect</span> <span class="o">=</span> <span class="mf">0.000005</span>      <span class="c1"># chosen simply for illustration</span>

<span class="c1"># run the epidemic equations</span>
<span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sss</span><span class="p">,</span> <span class="n">iss</span><span class="p">,</span> <span class="n">rss</span><span class="p">)</span> <span class="o">=</span> <span class="n">epidemic_sir</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">pInfected</span><span class="p">,</span> <span class="n">pInfect</span><span class="p">,</span> <span class="n">pRemove</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sss</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;suceptible (theory)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">iss</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;infected (theory)&#39;</span><span class="p">)</span>
<span class="c1">#ax.plot(ts, rss, &#39;k-&#39;, label=&#39;removed (theory)&#39;)</span>

<span class="c1"># run the corresponding simulation</span>
<span class="p">(</span><span class="n">sim_ts</span><span class="p">,</span> <span class="n">sim_sss</span><span class="p">,</span> <span class="n">sim_iss</span><span class="p">,</span> <span class="n">sim_rss</span><span class="p">)</span> <span class="o">=</span> <span class="n">network_sir</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">pInfected</span><span class="p">,</span> <span class="n">pInfect</span><span class="p">,</span> <span class="n">pRemove</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim_ts</span><span class="p">,</span> <span class="n">sim_sss</span><span class="p">,</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;suceptible (simulation)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim_ts</span><span class="p">,</span> <span class="n">sim_iss</span><span class="p">,</span> <span class="s1">&#39;gx&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;infected (simulation)&#39;</span><span class="p">)</span>
<span class="c1">#ax.plot(sim_ts, sim_rss, &#39;kx&#39;, label=&#39;removed (simulation)&#39;)</span>

<span class="c1"># fine-tune the figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Equations vs network ($p_{</span><span class="se">\\</span><span class="s1">mathit</span><span class="si">{Infect}</span><span class="s1">} = &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{b:.7f}</span><span class="s1">$, &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">pInfect</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;$p_</span><span class="si">{remove}</span><span class="s1"> = &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{a}</span><span class="s1">$)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">pRemove</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;population that is...&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;network-same-beta-alpha.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/network_21_0.svg" src="_images/network_21_0.svg" /></div>
</div>
<p>And so they do: the crosses of the simulation lie over the top of the solid lines of the SIR equations.</p>
</div>
<div class="section" id="towards-sparser-social-networks">
<h2>Towards sparser social networks<a class="headerlink" href="#towards-sparser-social-networks" title="Permalink to this headline">¶</a></h2>
<p>But that’s not a “reasonable” social network, any more than complete mixing was a reasonable assumption. A “reasonable” social network would have each person only meeting a few people – potentially a <em>lot</em> fewer. Meeting less people translates as having fewer potentially infection-spreading social contacts, so we might expect that the number of people the disease infects would drop as the social network of the population it was infecting grew sparser.</p>
<p>What does “sparser” mean mathematically? In the complete social network, everyone was connected to everyone else. If the network has 2000 people, then you have 1999 edges: one less than the population, because you don’t connect to yourself. We call the other people to whom you’re connected your <em>neighbours</em>. The number of neighbours you have is called your <em>degree</em>. In this case, your node in network has degree 1999.</p>
<p>If we look at everyone in the network, then <em>everyone</em> has the same degree: they’re all neighbours with everyone (except themselves). If we choose a node at random, it will have degree 1999.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">randomNode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">randomNode</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>1999
</pre></div>
</div>
</div>
</div>
<p>If we were to look at <em>all</em> the nodes and take their <em>average</em> or <em>mean</em> degree, then this would be the same, since all the nodes have the same degree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>1999
</pre></div>
</div>
</div>
</div>
<p>The degree of a node is usually denoted <span class="math notranslate nohighlight">\(k\)</span>, for no particular reason; the mean degree is then denoted <span class="math notranslate nohighlight">\(\langle k \rangle\)</span> – <span class="math notranslate nohighlight">\(k\)</span> between angle brackets. <span class="math notranslate nohighlight">\(\langle k \rangle\)</span> is a statistical measure of how “dense” the network is: a higher <span class="math notranslate nohighlight">\(\langle k \rangle\)</span> means that nodes have on average more connections to other nodes. As <span class="math notranslate nohighlight">\(\langle k \rangle\)</span> goes up the network gets denser and denser until it hits the maximum value where every node is connected to every other – we could denote this <span class="math notranslate nohighlight">\(\langle k \rangle_{max}\)</span>.</p>
<p>We can now ask ourselves the question: what happens as we vary <span class="math notranslate nohighlight">\(\langle k \rangle\)</span>? We already know that when <span class="math notranslate nohighlight">\(\langle k \rangle = \langle k \rangle_{max}\)</span> the network behaves like the equations. But what happens as <span class="math notranslate nohighlight">\(\langle k \rangle\)</span> gets lower – that is, people have fewer and fewer contacts with each other – for the <em>same</em> disease? We’d presumably expact that fewer people will become infected overall, which also suggests that at some point the disease will simply die out without affecting very many people at all.</p>
<p>Let’s see.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># draw sub-plots for the different values of kmean </span>
<span class="k">for</span> <span class="p">(</span><span class="n">kmean</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span> <span class="p">(</span><span class="mi">1999</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="p">(</span><span class="mi">500</span><span class="p">,</span>  <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="p">(</span><span class="mi">100</span><span class="p">,</span>  <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">]:</span>
    <span class="c1"># create the random network with the given mean degree</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">erdos_renyi_graph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="p">(</span><span class="n">kmean</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span>
    
    <span class="c1"># run the corresponding simulation</span>
    <span class="p">(</span><span class="n">sim_ts</span><span class="p">,</span> <span class="n">sim_sss</span><span class="p">,</span> <span class="n">sim_iss</span><span class="p">,</span> <span class="n">sim_rss</span><span class="p">)</span> <span class="o">=</span> <span class="n">network_sir</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">pInfected</span><span class="p">,</span> <span class="n">pInfect</span><span class="p">,</span> <span class="n">pRemove</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim_ts</span><span class="p">,</span> <span class="n">sim_sss</span><span class="p">,</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;suceptible&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim_ts</span><span class="p">,</span> <span class="n">sim_iss</span><span class="p">,</span> <span class="s1">&#39;gx&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;infected&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">langle k </span><span class="se">\\</span><span class="s1">rangle = </span><span class="si">{k}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">kmean</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">])</span>
        
<span class="c1"># fine-tune the figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Random networks with different $</span><span class="se">\\</span><span class="s1">langle k </span><span class="se">\\</span><span class="s1">rangle$ ($p_{</span><span class="se">\\</span><span class="s1">mathit</span><span class="si">{Infect}</span><span class="s1">} = &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{b:.7f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">pInfect</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, p_</span><span class="si">{remove}</span><span class="s1"> = &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{a}</span><span class="s1">$)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">pRemove</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;population that is...&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;network-kmean.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/network_29_0.svg" src="_images/network_29_0.svg" /></div>
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="continuous.html" title="previous page">The simplest model</a>
    <a class='right-next' id="next-link" href="notes.html" title="next page">Notes</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.<br/>
    </p>
  </div>
</footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>