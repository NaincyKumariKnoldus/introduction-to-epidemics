

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Physical distancing &#8212; Epidemic modelling &amp;ndash; Some notes, maths, and code</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/mystnb.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="Conclusion" href="conclusion.html" />
    <link rel="prev" title="Asymptomatic transmission" href="seir.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Epidemic modelling &ndash; Some notes, maths, and code</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="model.html">Models and modelling</a>
  </li>
  <li class="">
    <a href="progress.html">Disease progression</a>
  </li>
  <li class="">
    <a href="continuous.html">Compartmented models</a>
  </li>
  <li class="">
    <a href="network.html">Network models</a>
  </li>
  <li class="">
    <a href="er.html">Making fewer connections</a>
  </li>
  <li class="">
    <a href="tracing.html">Contact tracing</a>
  </li>
  <li class="">
    <a href="thresholds.html">Epidemic threshold</a>
  </li>
  <li class="">
    <a href="hcn.html">Human contact networks</a>
  </li>
  <li class="">
    <a href="herd.html">Herd immunity</a>
  </li>
  <li class="">
    <a href="vaccination.html">Changing individual susceptibility</a>
  </li>
  <li class="">
    <a href="seir.html">Asymptomatic transmission</a>
  </li>
  <li class="active">
    <a href="">Physical distancing</a>
  </li>
  <li class="">
    <a href="conclusion.html">Conclusion</a>
  </li>
  <li class="">
    <a href="reading.html">To find out more</a>
  </li>
  <li class="">
    <a href="zbibliography.html">References</a>
  </li>
  <li class="">
    <a href="genindex.html">Index</a>
  </li>
  <li class="">
    <a href="notes.html">Notes on production</a>
  </li>
  <li class="">
    <a href="acknowledgements.html">Acknowledgements</a>
  </li>
  <li class="">
    <a href="about.html">About the author</a>
  </li>
  <li class="">
    <a href="copyright.html">Copyright</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/distancing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/simoninireland/introduction-to-epidemics"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#a-physically-distanced-contact-network" class="nav-link">A physically-distanced contact network</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#making-some-choices" class="nav-link">Making some choices</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#disease-and-distancing" class="nav-link">Disease and distancing</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#questions-for-discussion" class="nav-link">Questions for discussion</a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="physical-distancing">
<h1>Physical distancing<a class="headerlink" href="#physical-distancing" title="Permalink to this headline">¶</a></h1>
<p><span class="target" id="index-0"></span>Quarantine seems to be very effective, especially when carried out strongly enough and when combined with effective detection of exposed individuals. But you need to get a lot right for it to work. Maybe there’s another way?</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Some people <em>never</em> develop symptoms: for some reason their immune systems suppress the disease enough to keep them well, but not enough to eliminate it and stop them being infectious. The most famous case of this phenomenon is “<span class="target" id="index-1"></span>Typhoid Mary”<a class="bibtex reference internal" href="zbibliography.html#mtk13" id="id1">[14]</a>, who infected a large number of people with typhoid fever despite showing no symptoms herself.</p>
</div>
<p>Let’s go back to basics. In <span class="target" id="index-2"></span>SEIR-style diseases we have the possibility of individuals walking around and spreading the disease without showing any symptoms. There is by definition no way (absent testing) to spot these individuals until (and unless) they show symptoms. So the challenge is to stop these infectious-but-asymptomatic individuals from coming into contact with susceptible individuals.</p>
<p>What if we re-structure the contact network so that people only have contact with a small group of people, and reduce the amount of mixing between those groups? If someone is infected in spite of everything then they’ll probably infect their own group, but they’ll be less opportunity to infect other groups. This strategy is referred to as <strong><span class="target" id="index-3"></span>physical distancing</strong>, reducing and re-structuring the connections within a population.</p>
<div class="section" id="a-physically-distanced-contact-network">
<h2>A physically-distanced contact network<a class="headerlink" href="#a-physically-distanced-contact-network" title="Permalink to this headline">¶</a></h2>
<p>Physical distancing is another topological approach to epidemic control. It works by changing the network over which the disease operates, rather than addressing the disease itself. Such approach is well-suited to new diseases and those for which there are few effective therapies.</p>
<p>What does “physical distancing” mean in network terms? We can understand it best by thinking about the actual conditions of socially-distant lockdown, and then re-creating this structure as a network.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Sometimes referred to as <strong><span class="target" id="index-4"></span>social distancing</strong>, although that feels like an oxymoron: it also sounds uncomfortably close to “social isolation”, which indeed is one of its major dangers as a technique.</p>
</div>
<p>The idea of physical distancing is to place individuals in small “<span class="target" id="index-5"></span>bubbles” of <span class="target" id="index-6"></span>contact – typically just their own immediate family – with whom they interact strongly, and weaken the connections that any family member has with individuals in other bubbles. Within a bubble, infection of one person will probably transfer quickly to most or all all of the other members. But the ability of the disease to pass between bubbles is substantially reduced, since there is relatively little contact between them. One can reduce the inter-bubble transmission even further using quarantine when someone realises they are infected.</p>
<p>In network terms, the <span class="target" id="index-7"></span>bubbles are <a class="reference internal" href="network.html#sec-network-complete"><span class="std std-ref">complete graphs</span></a> (everyone in a bubble meets everyone else) whose size depends on the size of the family. We could set all families to the same size, say 4; alternatively we could draw family sizes from some probability distribution where the average size of a family is 4.5 (2 adults with the proverbial 2.5 children) but we allow larger and smaller families to occur. Larger families risk more infections if a member is infected.</p>
<p>We now need to link the bubbles. In each bubble, some person or people meet with the outside world: perhaps they’re the designated shopper, or someone in a key role whose work brings them into contact with others. We then need to connect these people to other bubbles.</p>
<p>This description still leaves quite a lot to be decided:</p>
<ul class="simple">
<li><p>What is the distribution of family sizes? Are large families really unusual? Or do they follow a “normal” distribution?</p></li>
<li><p>How many people in each family connect to the outside? Is it always one or two? Might a large family have more contacts?</p></li>
<li><p>How do those in contact outside their family group connect with others? Are some people significantly more connected than others?</p></li>
</ul>
<p>These decisions are simply <span class="target" id="index-8"></span>additional <a class="reference internal" href="seir.html#sec-seir-degrees-of-freedom"><span class="std std-ref">degrees of freedom</span></a> (again) for our model – with all that this entails.</p>
<p>Creating such a network means addressing all these issues. There’s a trick we can perform, though. Notice that while the detailed choices change, the structure of the network doesn’t. This means that, just as our disease models have parameters that we can change, so does our socially-distanced network – with the difference that the network parameters are given by choices of probability distributions as well as single numbers. But the solution is the same: define what it means to build the network, providing these distributions as parameters that are “plugged in” to the same structure-building process.</p>
<p>Building the network involves a complicated piece of code – the most complicated we’ve seen so far.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">distanced_graph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">clusterSizeDistribution</span><span class="p">,</span> <span class="n">contactDistribution</span><span class="p">,</span> <span class="n">clusterContactDistribution</span><span class="p">):</span>
    <span class="c1"># build the initial graph</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    
    <span class="c1"># build the clusters, each being a complete</span>
    <span class="c1"># graph K_s of size s, labelled uniquely </span>
    <span class="c1"># within the overall graph</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cid</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
        <span class="c1"># build the cluster&#39;s graph with a random size</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">clusterSizeDistribution</span><span class="p">()</span>
        <span class="n">K_s</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">complete_graph</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        
        <span class="c1"># relabel the cluster graph so all nodes in the final</span>
        <span class="c1"># social distence graph have unique integer labels</span>
        <span class="n">networkx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">K_s</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">n</span> <span class="o">+</span> <span class="n">l</span><span class="p">,</span>
                               <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="c1"># add to the graph and list of clusters</span>
        <span class="c1"># label edges with the cluster they belong to</span>
        <span class="c1"># (numbered from 1) and the size of the cluster</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">K_s</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
                         <span class="n">cluster</span><span class="o">=</span><span class="n">cid</span><span class="p">,</span> <span class="n">cluster_size</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">K_s</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span>
                         <span class="n">cluster</span><span class="o">=</span><span class="n">cid</span><span class="p">,</span> <span class="n">cluster_size</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
        <span class="n">clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K_s</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="n">s</span>
        <span class="n">cid</span> <span class="o">+=</span> <span class="mi">1</span>
        
    <span class="c1"># draw the number of contact nodes per cluster from</span>
    <span class="c1"># from the distribution</span>
    <span class="n">contacts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">order</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">contactDistribution</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">contacts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        
    <span class="c1"># decide on the arity of each contact node</span>
    <span class="n">stubs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># first i node labels (since all nodes are</span>
        <span class="c1"># identical in K_s) </span>
        <span class="n">ls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">nodes</span><span class="p">())[:</span><span class="n">contacts</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>   
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">:</span>
            <span class="c1"># draw the number of contacts for this node</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">clusterContactDistribution</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            
            <span class="c1"># append e copies of the node label to</span>
            <span class="c1"># the list of stubs</span>
            <span class="n">stubs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">l</span><span class="p">]</span> <span class="o">*</span> <span class="n">e</span><span class="p">)</span>
    
    <span class="c1"># if number of stubs isn&#39;t even, add one to a</span>
    <span class="c1"># randomly-chosen node (don&#39;t favour</span>
    <span class="c1"># already-high-degree nodes</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stubs</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">us</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">stubs</span><span class="p">))</span>                
        <span class="n">j</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">us</span><span class="p">))</span>
        <span class="n">stubs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">us</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        
    <span class="c1"># shuffle the stubs until there are no edge</span>
    <span class="c1"># pair with the same endpoints</span>
    <span class="n">rng</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">stubs</span><span class="p">)</span> <span class="c1"># may leave loops</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># look for pairtings of stubs and others</span>
        <span class="c1"># within the same cluster, and break them</span>
        <span class="c1"># randomly (without changing the degree</span>
        <span class="c1"># distribution)</span>
        <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stubs</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stubs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stubs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;cluster&#39;</span><span class="p">]:</span>
                <span class="c1"># self loop, swap with another</span>
                <span class="c1"># randomly-chosen stub</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stubs</span><span class="p">))</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">stubs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">stubs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stubs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">stubs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
                
                <span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">swaps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># no swaps, we&#39;re finished</span>
            <span class="k">break</span>

    <span class="c1"># connect the nodes by pulling pairs of stubs</span>
    <span class="c1"># and creating an edge between them</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stubs</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="c1"># label inter-bubble edges as cluster 0 of size 0</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">stubs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">stubs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                   <span class="n">cluster</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cluster_size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># return the graph and list of cluster sizes</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">h</span><span class="p">:</span> <span class="n">h</span><span class="o">.</span><span class="n">order</span><span class="p">(),</span> <span class="n">clusters</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>This function takes four <span class="target" id="index-9"></span>parameters – the size of network and three probability-distribution functions – and returns a network and a list of the bubble sizes. Within the network it creates the social bubbles and labels them uniquely, and then connects the bubbles together randomly.</p>
</div>
<div class="section" id="making-some-choices">
<h2>Making some choices<a class="headerlink" href="#making-some-choices" title="Permalink to this headline">¶</a></h2>
<p>We can’t get away from making choices about these <span class="target" id="index-10"></span>degrees of freedom indefinitely, though – and in fact that time has arrived.</p>
<p>Since we’re interested in large-scale phenomena, let’s make some simple choices:</p>
<ul class="simple">
<li><p>Families whose sizes are normally-distributed integers with a mean of 4.5 and a standard deviation of 2</p></li>
<li><p>A <span class="target" id="index-11"></span>normal distribution of contacts in each family</p></li>
<li><p><span class="target" id="index-12"></span>Exponentially-distributed links betyween connections, to allow for very connected individuals</p></li>
</ul>
<p>Since it makes no sense to allow entirely isolated families, those with no size, and “connected” individuals with no contacts, we cut off all the distributions with a minimum of 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">averageFamily</span><span class="p">():</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">coupleOfContacts</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">expInterBubble</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>These three functions, coupled with the network size, are enough to build our network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">clusters</span><span class="p">)</span> <span class="o">=</span> <span class="n">distanced_graph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">averageFamily</span><span class="p">,</span> <span class="n">coupleOfContacts</span><span class="p">,</span> <span class="n">expInterBubble</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can check the various elements of this network. For example, we can check what range of family “bubble” sizes we have, and how connected the various contact individuals are.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean family size of </span><span class="si">{s:.2f}</span><span class="s1"> (range </span><span class="si">{minf}</span><span class="s1">-</span><span class="si">{maxf}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">clusters</span><span class="p">),</span> <span class="n">minf</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">clusters</span><span class="p">),</span> <span class="n">maxf</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">clusters</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Most connected individual has </span><span class="si">{k}</span><span class="s1"> contacts&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Mean family size of 4.00 (range 1-10)
Most connected individual has 55 contacts
</pre></div>
</div>
</div>
</div>
<p>We could also draw the network to inspect it, colouring the nodes with the size of cluster they belong to – although that turns out not to be especially revealing.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">draw_distanced</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cluster_size&#39;</span><span class="p">,</span>
                   <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># fill in defaults</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    
    <span class="c1"># work out the colours </span>
    <span class="n">ncs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">color</span><span class="p">],</span>
                   <span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">()))</span>
    <span class="n">ecs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="n">color</span><span class="p">],</span>
                   <span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">()))</span>
               
    <span class="c1"># draw with spring layout, which seems to</span>
    <span class="c1"># give good results</span>
    <span class="n">networkx</span><span class="o">.</span><span class="n">draw_spring</span><span class="p">(</span><span class="n">g</span><span class="p">,</span>
                         <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                         <span class="n">with_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">node_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                         <span class="n">node_color</span><span class="o">=</span><span class="n">ncs</span><span class="p">,</span>
                         <span class="n">edge_color</span><span class="o">=</span><span class="n">ecs</span><span class="p">,</span>
                         <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                         <span class="n">edge_cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="c1"># draw network</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">draw_distanced</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

<span class="c1"># add key (see https://matplotlib.org/examples/api/colorbar_only.html)</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">clusters</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">clusters</span><span class="p">)))</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>
<span class="n">cb2</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                                    <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                                    <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                    <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                    <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;proportional&#39;</span><span class="p">,</span>
                                    <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;physical-distancing.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/distancing_19_0.png" src="_images/distancing_19_0.png" />
</div>
</div>
<p>This isn’t a useless plot, once we know that more highly-connected clusters sit in the centre with less-connected clusters pushed to the outside. We can see these less-connected clusters, and in particular see that they have a range of colours, indicating that they’re of different sizes – and therefore giving confidence that the algorithm hasn’t (for example) only made large clusters highly connected.</p>
</div>
<div class="section" id="disease-and-distancing">
<h2>Disease and distancing<a class="headerlink" href="#disease-and-distancing" title="Permalink to this headline">¶</a></h2>
<p>Now we can run a disease process over our network. We’ll stick to <span class="target" id="index-13"></span>SIR to reduce the number of degrees of freedom we have to deal with: running with <span class="target" id="index-14"></span>SEIR would be easy to do too, of course, but presents us with even more choices.</p>
<p>What do we expect from a disease in these circumstances? The purpose of physical distancing is to reduce the connectivity of people, which (all things being equal) should reduce the disease’s spread. But it does so by building tight clusters of individuals within bubbles, meaning that infecting one person is likely to infect everyone. And we’ve used an exponential distribution of contacts to allow the creation of high-degree hubs, meaning that infecting one of these will potentially infect a lot of others.</p>
<p>The best we can probably say at this stage, then, is that … it’s complicated. Which is just the sort of situation simulation is intended for.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lab</span> <span class="o">=</span> <span class="n">epyc</span><span class="o">.</span><span class="n">ClusterLab</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="s1">&#39;hogun&#39;</span><span class="p">,</span>
                      <span class="n">notebook</span><span class="o">=</span><span class="n">epyc</span><span class="o">.</span><span class="n">JSONLabNotebook</span><span class="p">(</span><span class="s1">&#39;datasets/sir-phydist.json&#39;</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>If we cast the above code into a format suitable for running as an experiment, we can then look at how an epidemic proceeds for a sample point in the parameter space.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">pxlocal</span>

<span class="k">class</span> <span class="nc">PhyDistNetworkDynamics</span><span class="p">(</span><span class="n">epydemic</span><span class="o">.</span><span class="n">StochasticDynamics</span><span class="p">):</span>
    
    <span class="c1"># Experimental parameters</span>
    <span class="n">N</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
    <span class="n">BUBBLE_MEAN</span> <span class="o">=</span> <span class="s1">&#39;bubbleMean&#39;</span>
    <span class="n">BUBBLE_STDDEV</span> <span class="o">=</span> <span class="s1">&#39;bubbleStddev&#39;</span>
    <span class="n">INTERBUBBLE_EXP</span><span class="o">=</span> <span class="s1">&#39;interBubbleExp&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PhyDistNetworkDynamics</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">bubbleSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bubbleMean</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_bubbleStddev</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>    

    <span class="k">def</span> <span class="nf">interBubble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_interBubbleExponent</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">distanced</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    
        <span class="n">rng</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubbleSize</span><span class="p">()</span>
            <span class="n">K_s</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">complete_graph</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            
            <span class="n">networkx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">K_s</span><span class="p">,</span>
                                   <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">n</span> <span class="o">+</span> <span class="n">l</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">K_s</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
                             <span class="n">cluster</span><span class="o">=</span><span class="n">cid</span><span class="p">,</span> <span class="n">cluster_size</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">K_s</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span>
                             <span class="n">cluster</span><span class="o">=</span><span class="n">cid</span><span class="p">,</span> <span class="n">cluster_size</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
            <span class="n">clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K_s</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="n">s</span>
            <span class="n">cid</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="n">contacts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">order</span><span class="p">()</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">contacts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            
        <span class="n">stubs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">nodes</span><span class="p">())[:</span><span class="n">contacts</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> 
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interBubble</span><span class="p">()</span>
                <span class="n">stubs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">l</span><span class="p">]</span> <span class="o">*</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stubs</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">us</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">stubs</span><span class="p">))</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">us</span><span class="p">))</span>
            <span class="n">stubs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">us</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        
        <span class="n">rng</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">stubs</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stubs</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stubs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stubs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;cluster&#39;</span><span class="p">]:</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stubs</span><span class="p">))</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">stubs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">stubs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stubs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">stubs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
                    <span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">swaps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stubs</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">stubs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">stubs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                       <span class="n">cluster</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cluster_size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">g</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PhyDistNetworkDynamics</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        
        <span class="n">N</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bubbleMean</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">BUBBLE_MEAN</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bubbleStddev</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">BUBBLE_STDDEV</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interBubbleExponent</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">INTERBUBBLE_EXP</span><span class="p">]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distanced</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setNetworkPrototype</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># network size</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="c1"># simulation time</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">5000</span>

<span class="c1"># disease parameters</span>
<span class="n">pInfected</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">pInfect</span> <span class="o">=</span> <span class="mf">0.0003</span>
<span class="n">pRemove</span> <span class="o">=</span> <span class="mf">0.002</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># experimental parameters common to both experiments</span>
<span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">params</span><span class="p">[</span><span class="n">PhyDistNetworkDynamics</span><span class="o">.</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">params</span><span class="p">[</span><span class="n">PhyDistNetworkDynamics</span><span class="o">.</span><span class="n">BUBBLE_MEAN</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.5</span>
<span class="n">params</span><span class="p">[</span><span class="n">PhyDistNetworkDynamics</span><span class="o">.</span><span class="n">BUBBLE_STDDEV</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">params</span><span class="p">[</span><span class="n">PhyDistNetworkDynamics</span><span class="o">.</span><span class="n">INTERBUBBLE_EXP</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">params</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_INFECTED</span><span class="p">]</span> <span class="o">=</span> <span class="n">pInfected</span>
<span class="n">params</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_INFECT</span><span class="p">]</span> <span class="o">=</span> <span class="n">pInfect</span>
<span class="n">params</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_REMOVE</span><span class="p">]</span> <span class="o">=</span> <span class="n">pRemove</span>
<span class="n">params</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">DELTA</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="mi">50</span>

<span class="c1"># create model and experiment over distance network</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MonitoredSIR</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">setMaximumTime</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">PhyDistNetworkDynamics</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">rc</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="n">timeseries</span> <span class="o">=</span> <span class="n">rc</span><span class="p">[</span><span class="n">epyc</span><span class="o">.</span><span class="n">Experiment</span><span class="o">.</span><span class="n">RESULTS</span><span class="p">][</span><span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">TIMESERIES</span><span class="p">]</span>
<span class="n">tss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">OBSERVATIONS</span><span class="p">]</span>
<span class="n">sss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">SUSCEPTIBLE</span><span class="p">]</span>
<span class="n">iss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">INFECTED</span><span class="p">]</span>
<span class="n">rss</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tss</span><span class="p">,</span> <span class="n">sss</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;susceptible&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tss</span><span class="p">,</span> <span class="n">iss</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;infected&#39;</span><span class="p">)</span>
<span class="c1">#ax.plot(tss, rss, &#39;k-&#39;, label=&#39;removed&#39;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;population that is...&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>

<span class="c1"># fine-time the figure</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SIR on a physically distant network ($p_{\mathit</span><span class="si">{infect}</span><span class="s1">} = &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{p}</span><span class="s1">$)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">pInfect</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/distancing_31_0.png" src="_images/distancing_31_0.png" />
</div>
</div>
<p>Compare this to the <a class="reference internal" href="thresholds.html#sec-thresholds-er"><span class="std std-ref">same disease on an ER network</span></a>. The epidemic doesn’t really get started in the network, even for a value of <span class="math notranslate nohighlight">\(p_{\mathit{infect}}\)</span> that previous experience would suggest would be sufficient. We can explore this by checking the size of the epidemic across a range of infectiousness values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># network parameters</span>
<span class="n">lab</span><span class="p">[</span><span class="n">PhyDistNetworkDynamics</span><span class="o">.</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">lab</span><span class="p">[</span><span class="n">PhyDistNetworkDynamics</span><span class="o">.</span><span class="n">BUBBLE_MEAN</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.5</span>
<span class="n">lab</span><span class="p">[</span><span class="n">PhyDistNetworkDynamics</span><span class="o">.</span><span class="n">BUBBLE_STDDEV</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">lab</span><span class="p">[</span><span class="n">PhyDistNetworkDynamics</span><span class="o">.</span><span class="n">INTERBUBBLE_EXP</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="c1"># disease parameters</span>
<span class="n">lab</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_INFECTED</span><span class="p">]</span> <span class="o">=</span> <span class="n">pInfected</span>
<span class="n">lab</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_INFECT</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0008</span><span class="p">,</span>
                                            <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">lab</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_REMOVE</span><span class="p">]</span> <span class="o">=</span> <span class="n">pRemove</span>

<span class="n">lab</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">DELTA</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="mi">50</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MonitoredSIR</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">setMaximumTime</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">PhyDistNetworkDynamics</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">lab</span><span class="o">.</span><span class="n">runExperiment</span><span class="p">(</span><span class="n">epyc</span><span class="o">.</span><span class="n">RepeatedExperiment</span><span class="p">(</span>
                    <span class="n">epyc</span><span class="o">.</span><span class="n">RepeatedExperiment</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> 
                  <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">epyc</span><span class="o">.</span><span class="n">JSONLabNotebook</span><span class="p">(</span><span class="s1">&#39;datasets/sir-phydist.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dataframe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="c1"># plot the size of the removed population</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">P_INFECT</span><span class="p">],</span>
        <span class="n">df</span><span class="p">[</span><span class="n">epydemic</span><span class="o">.</span><span class="n">SIR</span><span class="o">.</span><span class="n">REMOVED</span><span class="p">],</span> <span class="s1">&#39;r,&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$p_{</span><span class="se">\\</span><span class="s1">mathit</span><span class="si">{infect}</span><span class="s1">}$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;population that is...&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SIR with physical distancing ($N = </span><span class="si">{n}</span><span class="s1">$)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">N</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;sir-phydist.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/distancing_37_0.png" src="_images/distancing_37_0.png" />
</div>
</div>
<p>Comparing this with the <a class="reference internal" href="thresholds.html#sec-thresholds-er"><span class="std std-ref">same disease on ER networks</span></a> we see that the epidemic takes off similarly. Why is this? – it would need more exploration, but the way we set up the socially distanced model did include powerlaw-distributed contacts between bubbles. It could be that these superspreaders are responsible for  spreading the disease between bubbles, at which point is spreads easily within them.</p>
<p>This brings up an important point about social distancing, and in particular about how to weaken such a lockdown. The size of <span class="target" id="index-15"></span>bubbles, and their interconnection doesn’t matter <strong>as long as there is no infection present in the bubble</strong> – but it matters critically when there <em>is</em> infection, and especially if one of the bubble’s contact points is highly connected. This makes the issue of acceptable behaviour very important, since smaller, more isolated, bubbles will both incur less infection within themselves (since there are fewer people) and potentially transmit less (by having fewer outside contacts).</p>
</div>
<div class="section" id="questions-for-discussion">
<h2>Questions for discussion<a class="headerlink" href="#questions-for-discussion" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The case of Typhoid Mary raises some troubling questions. Is it right to lock someone up when they’re done nothing personally wrong, to protect the community? What alternatives were there, before treatments like antibiotics were available? What might we do today?</p></li>
<li><p>Physical distancing doesn’t have to be uniform for everyone. Some people are in more need of protection (“shielding”) than others. How could we introduce this into a model?</p></li>
</ul>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="seir.html" title="previous page">Asymptomatic transmission</a>
    <a class='right-next' id="next-link" href="conclusion.html" title="next page">Conclusion</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Simon Dobson<br/>
        
            &copy; <a href="copyright.html">Copyright</a> 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-42241903-2', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>